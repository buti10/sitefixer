<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Malware-Report {{ report_date }} · Ticket #{{ ticket_id }}</title>
  <style>
    :root{
      --bg:#f7f7fb; --card:#fff; --ink:#0f172a;
      --muted:#64748b; --border:#e5e7eb;
      --ok:#16a34a; --warn:#f59e0b; --bad:#dc2626; --chip:#0ea5e9;
    }
    *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .page{max-width:1100px;margin:26px auto;padding:0 18px}
    .head{display:flex;justify-content:space-between;align-items:start;margin-bottom:16px}
    h1{font-size:22px;margin:0 0 6px}
    .meta{color:var(--muted);font-size:12px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin:10px 0}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .kpi{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px}
    .kpi h3{margin:0 0 4px;font-size:12px;color:var(--muted)}
    .kpi .v{font-size:20px;font-weight:600}
    .kpi.ok .v{color:var(--ok)} .kpi.warn .v{color:var(--warn)} .kpi.bad .v{color:var(--bad)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-top:1px solid var(--border);vertical-align:top}
    thead th{border-top:none;text-align:left;font-size:12px;color:var(--muted);background:#fbfbfe}
    .path{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .sev{display:inline-block;padding:.15rem .45rem;border-radius:999px;font-size:11px;font-weight:600}
    .sev.low{color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0}
    .sev.medium{color:#92400e;background:#fffbeb;border:1px solid #fde68a}
    .sev.high{color:#b91c1c;background:#fef2f2;border:1px solid #fecaca}
    .sev.critical{color:#7f1d1d;background:#fee2e2;border:1px solid #fecaca}
    .snippet{white-space:pre-wrap;background:#0f172a; color:#e2e8f0; padding:8px;border-radius:8px;margin-top:6px;font-size:12px}
    .chips span{display:inline-block;margin-right:6px;margin-top:4px;padding:.2rem .5rem;border:1px solid var(--border);border-radius:999px;background:#f1f5f9;color:#0f172a;font-size:11px}
  </style>
</head>
<body>
<div class="page">

  <div class="head">
    <div>
      <h1>Malware-Report {{ report_date }}</h1>
      <div class="meta">
        Ticket #{{ ticket_id }}
        {% if domain %} · Domain: <strong>{{ domain }}</strong>{% endif %}
        {% if root_path %} · Pfad: <span class="path">{{ root_path }}</span>{% endif %}
        · Scan-ID: {{ scan_id }}
        {% if started_at %} · Start: {{ started_at }}{% endif %}
        {% if finished_at %} · Ende: {{ finished_at }}{% endif %}
      </div>
      {% if cms or php_version %}
      <div class="chips">
        {% if cms %}<span>CMS: {{ cms }}</span>{% endif %}
        {% if php_version %}<span>PHP: {{ php_version }}</span>{% endif %}
      </div>
      {% endif %}
    </div>
  </div>

  <div class="kpis">
    <div class="kpi"><h3>Total</h3><div class="v">{{ counts.total or 0 }}</div></div>
    <div class="kpi ok"><h3>Clean</h3><div class="v">{{ counts.clean or 0 }}</div></div>
    <div class="kpi warn"><h3>Suspicious</h3><div class="v">{{ counts.suspicious or 0 }}</div></div>
    <div class="kpi bad"><h3>Malicious</h3><div class="v">{{ counts.malicious or 0 }}</div></div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 6px">Findings</h3>
    <table>
      <thead>
        <tr>
          <th style="width:45%">Pfad</th>
          <th style="width:15%">Regel / Kategorie</th>
          <th style="width:10%">Schwere</th>
          <th style="width:30%">Hinweis / Code</th>
        </tr>
      </thead>
      <tbody>
      {% if items %}
        {% for f in items %}
          <tr>
            <td class="path">{{ f.path }}</td>
            <td>{{ f.kind or '—' }}</td>
            <td><span class="sev {{ (f.severity or 'low')|lower }}">{{ f.severity or 'low' }}</span></td>
            <td>
              {% if f.detail %}
                {% set d = f.detail if d is string else f.detail %}
                {% if d.snippet %}<div class="snippet">{{ d.snippet }}</div>{% endif %}
                {% if d.hint %}<div style="margin-top:6px;">{{ d.hint }}</div>{% endif %}
              {% else %}
                —
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="4">Keine Findings.</td></tr>
      {% endif %}
      </tbody>
    </table>
  </div>

</div>
</body>
</html>
